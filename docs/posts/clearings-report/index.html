<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Liam Smith">
<meta name="dcterms.date" content="2023-03-10">
<meta name="description" content="Sensitivity of viewshed analyses to different Digital Elevation Models.">

<title>Liam Smith - Scenic Viewsheds</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner h1,
      .quarto-title-block .quarto-title-banner h2,
      .quarto-title-block .quarto-title-banner h3,
      .quarto-title-block .quarto-title-banner h4,
      .quarto-title-block .quarto-title-banner h5,
      .quarto-title-block .quarto-title-banner h6
      {
        color: #f2f2f2;
      }

      .quarto-title-block .quarto-title-banner {
        color: #f2f2f2;
background-image: url(../../img/panorama5.jpg);
background-size: cover;
      }
</style>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Liam Smith</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../portfolio.html"> 
<span class="menu-text">Portfolio</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Liam-W-Smith"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/liam-smith-b159791b3/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Scenic Viewsheds</h1>
                  <div>
        <div class="description">
          Sensitivity of viewshed analyses to different Digital Elevation Models.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Conservation</div>
                <div class="quarto-category">Google Earth Engine</div>
                <div class="quarto-category">QGIS</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Liam Smith </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">March 10, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>When one thinks of conservation efforts, they probably imagine preservation of natural spaces and indigenous flora and fauna. A lesser known, yet nonetheless important, aspect of conservation planning is the scenic aspect. Breathtaking views, be they of mountain peaks or of rolling fields, are a critical aspect of our interaction with the natural landscape, and it would be a disservice to future generations to let them disappear. In this analysis, I investigate the effects of using different types of Digital Elevation Models in viewshed analyses, hoping this information will be valuable to conservation planners seeking to preserve scenic views.</p>
</section>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>You don’t have to go far to see the importance of scenic views in conservation efforts. Middlebury’s own Town Plan includes a section on “scenic resources management” which enumerates a number of vistas that are critical to the character of the town (Planning Commission, 2017). The nearby town of Monkton commissioned a 27-page-long report inventorying their scenic views for planning purposes (Addison County RPC, 2016). And in a previous winter term class at Middlebury College, students identified scenic features in the Town of Middlebury as a part of a conservation plan they created for the town (Anixter et al., 2013a).</p>
<p>Although scenic views are a subjective matter, planners – including the authors of the Monkton report and the student conservation plan – still employ GIS methods to aid in the identification of prime viewing locations. In particular, to determine what can be seen from a given location, a planner might conduct a viewshed analysis (Addison County RPC, 2016).</p>
<p>A viewshed analysis determines whether a raster of points in a Digital Elevation Model (DEM) are in the line of sight from a given viewpoint(s) (Addison County RPC, 2016). There are more sophisticated viewshed tools, but the basic version outputs a binary raster with a 1 where a location is visible and a 0 where a location is not visible (Cuckovic, 2016). While viewsheds provide planners with a seemingly more objective way of determining prime viewing locations, there are plenty of errors inherent to this type of analysis.</p>
<p>In this report, we will investigate the sensitivity of viewshed analyses on Middlebury College lands to the choice of DEM. This is a highly relevant parameter to investigate, because whether a given point is visible from a given viewpoint depends entirely on the elevation data in the DEM. Furthermore, planners are not consistent in the DEMs they choose for their analyses. For example, the authors of the Monkton report used a Digital Terrain Model (DTM) in their analysis, completely ignoring forest cover (Addison County RPC, 2016). On the other hand, the Middlebury students attempted to account for forest cover by adding 15 meters to a DTM where vegetation was present, regardless of whether that vegetation was actually trees or whether the trees were actually that tall (Anixter et al., 2013b). Other authors suggest beginning with a Digital Terrain Model and modifying it with vegetation elevation data from a Digital Surface Model or other source (Guth, 2009). In this report, we compare viewsheds generated for four different viewpoints using a bare earth DTM, a leaf-off DEM derived from a DTM and a DSM, and a leaf-on DEM derived from the same DTM and DSM.</p>
</section>
<section id="methods-results" class="level2">
<h2 class="anchored" data-anchor-id="methods-results">Methods &amp; Results</h2>
<p>First, I walked around campus, selected four points of varying surroundings (open field, built environment, deciduous trees, and coniferous trees), and took pictures at those locations to ground-truth my results. I also used go/mobility to record each point’s latitude and longitude.</p>
<p>Back at my computer, I imported a DTM and a DSM from the Vermont Center for Geographic Information into Google Earth Engine and used them to generate the three DEMs: bare earth (DTM), leaf-off, and leaf-on. I exported these DEMs to my Google drive and exported their corresponding hillshades as an asset, and I made my code available here.</p>
<p>I then created an excel file for each point containing the point’s latitude and longitude, added these as delimited text layers into QGIS, and then used the “Create Viewpoint” tool in the QGIS “Visibility Analysis” plugin to make each viewpoint suitable for the viewshed analysis. Since people generally stand on the ground – not in trees – I used the bare earth digital terrain model to create the viewpoints. For my radius of analysis, I chose 15,000 meters in order to cover the entire DEMs I downloaded for Middlebury. For my observer height, I used 1.6 meters, and for my target height, I used 0 meters. After that, I used the “Viewshed” tool in the “Visibility Analysis” plugin to create viewsheds for each point and each terrain model. After generating all 12 viewsheds, I uploaded them to Google Earth Engine as GeoTIFF assets and enabled sharing.</p>
<p>Back in Google Earth Engine, I imported my viewsheds and created maps of agreement and disagreement between the three DEMs for each of my four points. This visualization script is available here. Please see the resulting images and figures in the following few pages.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset nav-pills">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Point 1: Built Environment</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Point 2: Open/Field</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Point 3: Deciduous</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">Point 4: Coniferous</a></li></ul>
<div class="tab-content nav-pills">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<figure class="figure">
<div>

</div>
<div class="quarto-layout-panel" data-layout="[46.7, 53.3]">
<div class="quarto-layout-row">
<div id="first-column" class="quarto-layout-cell" style="flex-basis: 46.7%;justify-content: flex-start;">
<p><img src="assets/fig1a.jpg" class="img-fluid quarto-figure quarto-figure-right figure-img" style="width:100.0%"> <img src="assets/fig1b.jpg" class="img-fluid quarto-figure quarto-figure-right figure-img" style="width:100.0%"></p>
</div>
<div id="second-column" class="quarto-layout-cell" style="flex-basis: 53.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/fig1c.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</figure>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/fig3.png" class="img-fluid figure-img"></p>
<figcaption>Figure 1: Agreement and disagreement map for chapel viewpoint over a leaf-on hillshade.</figcaption>
</figure>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div>

</div>
<div class="quarto-layout-panel" data-layout-nrow="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="assets/fig4a.jpg" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="assets/fig4b.jpg" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="assets/fig4c.jpg" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="assets/fig4d.jpg" class="img-fluid"></p>
</div>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/fig6.png" class="img-fluid figure-img"></p>
<figcaption>Figure 2: Agreement and disagreement map for the open field viewpoint over a leaf-on hillshade.</figcaption>
</figure>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div>

</div>
<div class="quarto-layout-panel" data-layout-nrow="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="assets/fig7a.jpg" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="assets/fig7b.jpg" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="assets/fig7c.jpg" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="assets/fig7d.jpg" class="img-fluid"></p>
</div>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/fig9.png" class="img-fluid figure-img"></p>
<figcaption>Figure 3: Agreement and disagreement map for deciduous viewpoint over a leaf-on hillshade.</figcaption>
</figure>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<div>

</div>
<div class="quarto-layout-panel" data-layout-nrow="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="assets/fig10a.jpg" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="assets/fig10b.jpg" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="assets/fig10c.jpg" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="assets/fig10d.jpg" class="img-fluid"></p>
</div>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/fig12.png" class="img-fluid figure-img"></p>
<figcaption>Figure 4: Agreement and disagreement map for coniferous viewpoint over a leaf-on hillshade.</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="discussion" class="level2">
<h2 class="anchored" data-anchor-id="discussion">Discussion</h2>
<p>First, let us turn our attention to the agreement and disagreement maps. In these maps, a pixel is green if all viewsheds agree that the land represented by that pixel is visible and gray/black if all viewsheds agree that the land represented by that pixel is not visible. Notice how much of these maps are neither gray nor green. This indicates that there is substantial disagreement between the viewsheds produced by different DEMs. Let us investigate the ways in which each DEM affects our results.</p>
<p>When the bare earth model is the only DEM in which a pixel can be seen, my maps color that pixel brown; when the bare earth model is the only DEM in which a pixel cannot be seen, my maps color that pixel purple. Notice how much brown there is in these maps, particularly for points 1 and 4 (Fig 1, 4). When there are no trees and buildings in the way, we can often see further. In reality, we cannot see through buildings and trees, so including them in our analysis improves the accuracy of our results. On the other hand, notice how little purple shows up in our maps. This indicates that we tend not to miss stuff in our analysis when using a DTM. If we want to minimize the amount of visible land that we fail to include in our results, the bare earth model would be a good – generous – approach. When we do see purple, it tends to occur on rooftops, since our bare earth model ignores buildings (Fig 3, 6, 9).</p>
<p>Now let’s turn our attention to the leaf-off DEM. When the leaf-off model is the only DEM in which a pixel can be seen, my maps color that pixel red; when the bare earth model is the only DEM in which a pixel cannot be seen, my maps color that pixel dark blue. There is relatively little red in my maps – this tends to occur on buildings that are visible when their height is raised to the accurate level in the leaf-off model but are blocked from our vision when deciduous trees get in the way in the leaf-on model (Fig 1, 2, 3). It may be more accurate to use the leaf-off model when modeling winter conditions and the leaf-on model when modeling summer conditions, but this also becomes complicated because one still cannot see through tree trunks and branches in the winter.</p>
<p>Finally, we turn our attention to the leaf-on DEM. When the leaf-on model is the only DEM in which a pixel can be seen, my maps color that pixel cyan; when the leaf-on model is the only DEM in which a pixel cannot be seen, my maps color that pixel yellow. Some cyan patches occur where there are deciduous trees – this makes sense because the trees raise the elevation of these pixels, making them more visible (Fig 1, 2, 3, 4). There are also some instances of swaths of open fields and buildings that are only visible in the leaf-on model (Fig 1, 3). It seems to me that additional trees would only serve to obscure the views of fields and buildings behind them, so I don’t understand why this occurs. Finally, as you can see by scrolling between analogous figures with the leaf-off and leaf-on hillshades, yellow shows up where points are hidden behind deciduous trees but visible if those trees are absent, as one would expect (Fig 1, 2, 3, 4).</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>These results reveal both strengths and weaknesses of all three DEMs. If one cares more about ensuring that all points that are truly visible are marked as visible in their analysis, they might opt for the DTM – or maybe just add buildings to the DTM – and accept that their model will overestimate results, as the authors acknowledged in the Monkton report (Addison County RPC, 2016). If one cares more about ensuring that points marked as visible by their analysis truly are visible in reality, they might opt for the leaf-off or leaf-on composite DEM, depending on whether it is winter or summer, as the students did in their winter term conservation planning class or in the more sophisticated manner illustrated in my Earth Engine script (Anixter et al., 2013a). While the latter approach will reduce the number of points falsely labelled as visible, it will also increase the number of points falsely labelled as not visible, because in reality one can see through gaps in the trunks and branches of trees. Overall, there are strengths and weaknesses to each DEM; perhaps an analyst’s choice of DEM should depend on which type of error they wish to minimize.</p>
<p>In this report, I conducted a cursory analysis of the strengths and weaknesses of different DEMs in viewshed analysis, but I did not have the opportunity to conduct a viewshed analysis for all Middlebury College lands. Future work ought to actually identify places on Middlebury College lands with scenic value for the purposes of conservation planning. Additionally, while my figures revealed a lot about the ways in which different DEMs overestimate or underestimate viewsheds compared to other DEMs, there were some observations that I failed to explain, as well as other options for DEMs (such as bare earth plus buildings), both of which future work could investigate.</p>
<p>Furthermore, any substantive work surrounding scenic views ought to incorporate personal opinion, perhaps via survey or public forum, in order to incorporate the subjectivity of aesthetics into the identification of scenic views. It is worth considering whether it makes sense at all to use a machine to perform such a subjective task as locating places of beauty.</p>
</section>
<section id="bibliography" class="level2">
<h2 class="anchored" data-anchor-id="bibliography">Bibliography</h2>
<p>Addison County Regional Planning Commission. (2016). Monkton Scenic Viewshed Study 2015‐2016. https://drive.google.com/file/d/1r6ooUZvOWZ3z-sEZjNT2B5r29Orfhnut/view</p>
<p>Anixter, H., Bering, J., Bernegger, Q., &amp; Borah, A. (2013a). A Conservation Plan for Middlebury, Vermont. https://drive.google.com/file/d/1-LkGxMfSvb1wxqfrQ2jB41S2vjYIS0go/view</p>
<p>Anixter, H., Bering, J., Bernegger, Q., &amp; Borah, A. (2013b). Technical Appendix. https://drive.google.com/file/d/1-LkGxMfSvb1wxqfrQ2jB41S2vjYIS0go/view</p>
<p>Cuckovic, Z. (2016). Advanced Viewshed Analysis: A Quantum GIS Plug-in for the Analysis of Visual Landscapes. The Journal of Open Source Software, 1(4), 32. https://doi.org/10.21105/joss.00032</p>
<p>Guth, P. (2009). Incorporating Vegetation in Viewshed and Line-of-Sight Algorithms. ASPRS/MAPPS 2009 Specialty Conference. https://www.asprs.org/wp-content/uploads/2010/12/Guth.pdf</p>
<p>Planning Commission. (2017). Middlebury 2017 Town Plan. Town of Middlebury. https://cms5.revize.com/revize/middlebury/document_center/Planning%20Zoning/Middlebury-2017-Town-Plan.pdf</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>